<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบทดสอบก่อนเรียน</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700&family=Prompt:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="pretesta1.css">
  <link rel="stylesheet" href="pretest2.1.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img class="logo img-fluid" src="pic/logo2.png" alt="โลโก้">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="index.html">หน้าแรก</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">รายวิชา</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">ข่าวประชาสัมพันธ์</a></li>
                    <li class="nav-item"><a class="nav-link" href="faq.html">คำถามที่พบบ่อย</a></li>
                    <li class="nav-item"><a class="nav-link" href="usebility.html">วิธีการใช้งาน</a></li>
                    <li class="nav-item"><a class="nav-link" href="contect.html">ติดต่อเรา</a></li>
                </ul>
                <div class="navbar-right">
                    <a href="Library.html"><img src="pic/icons8-search-30.png" alt="ค้นหา" width="24"></a>
                    <span class="divider"></span>
 
                    <div class="dropdown user-dropdown">
                        <button class="btn-user" id="userBtn">
                            <img id="navbarUserImg" src="pic/icons8-user-24.png" class="user-icon">
                            <span id="navbarUserName">ชื่อผู้ใช้งาน</span>
                            <img src="pic/icons8-menu-50 (1).png" class="btn-icon">
                        </button>
 
                        <div class="dropdown-content user-menu-box">
                            <div class="user-menu-header">
          <img id="userMenuProfileImg" src="pic/icons8-user-64.png" class="profile-preview">
          <div class="profile-name" id="userMenuName">ชื่อผู้ใช้งาน</div>
          <div class="profile-sub text-center">
    <a href="priv.html" class="d-block text-center">
        ข้อมูลส่วนตัว
    </a>
</div>
      </div>
 
                            <a href="#"><img src="https://img.icons8.com/ios-glyphs/30/todo-list--v1.png"> สถานะการเรียน</a>
                            <a href="#"><img src="https://img.icons8.com/ios/50/calendar--v1.png"> แผนการเรียน</a>
                            <a href="#"><img src="https://img.icons8.com/ios/50/calendar-plus.png"> ปฏิทินกิจกรรม</a>
 
                            <hr>
                            <a href="#">ระบบจัดการ (เฉพาะ Admin)</a>
                            <a href="login.html" class="logout">ออกจากระบบ</a>
                        </div>
                    </div>
 
                    <div class="dropdown">
                        <button class="dropdown-btn" id="langBtn">
                            <img src="https://img.icons8.com/color/48/thailand.png" class="flag-icon" id="currentFlag"> ไทย
                        </button>
                        <div class="dropdown-content">
                            <a href="#" data-lang="th" data-flag="https://img.icons8.com/color/48/thailand.png">
                                <img src="https://img.icons8.com/color/48/thailand.png" class="flag-icon"> ไทย
                            </a>
                            <a href="#" data-lang="en" data-flag="https://img.icons8.com/color/48/usa.png">
                                <img src="https://img.icons8.com/color/48/usa.png" class="flag-icon"> English
                            </a>
                        </div>
                    </div>
 
                </div>
            </div>
        </div>
    </nav>

    <div class="breadcrumb-bar">
        <div class="container">
            <a href="index.html">
                <img src="pic/icons8-home-24.png" alt="home" class="breadcrumb-icon">
            </a>
            <span class="separator">
                <img src="pic/icons8-forward-24.png" alt=">">
            </span>
            <span class="current">รายวิชา</span>
            <span class="separator">
                <img src="pic/icons8-forward-24.png" alt=">">
            </span>
            <span class="current">ชื่อรายวิชา</span>
            <span class="separator">
                <img src="pic/icons8-forward-24.png" alt=">">
            </span>
            <span class="current">แบบทดสอบก่อนเรียน</span>
        </div>
    </div>

    <main style="padding: 40px 0; min-height: 80vh;">
        <div class="container">
            <!-- หัวข้อหลัก -->
            <h2 class="test-main-title">แบบทดสอบก่อนเรียน (Pre-Test)</h2>

            <div class="row">
                <!-- คำถามฝั่งซ้าย -->
                <div class="col-lg-7">
                    <div class="question-card">
                        <div class="question-header">
                            ข้อ <span id="currentQuestion">1</span>
                        </div>
                        <div class="question-text" id="questionText">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit, seddiamonummy eirmod tempor invidiunt ut labore et dolore magna aliquam erat, sed diam voluptus ?
                        </div>
                        <div class="answer-options">
                            <div class="answer-option">
                                <input type="radio" name="answer" id="true" value="true">
                                <label for="true">True</label>
                            </div>
                            <div class="answer-option">
                                <input type="radio" name="answer" id="false" value="false">
                                <label for="false">False</label>
                            </div>
                        </div>
                    </div>

                    <div class="nav-buttons">
                        <button class="btn btn-nav btn-prev" id="btnPrev" onclick="previousQuestion()" style="display: none;">
                            <i class="bi bi-arrow-left"></i> ย้อนกลับ
                        </button>
                        <button class="btn btn-nav btn-next" id="btnNext" onclick="nextQuestion()">
                            ถัดไป <i class="bi bi-arrow-right"></i>
                        </button>
                        <button class="btn btn-nav btn-submit" id="btnSubmit" onclick="submitTest()" style="display: none;">
                            ส่งข้อสอบ
                        </button>
                    </div>
                </div>

                <!-- แถบข้างขวา -->
                <div class="col-lg-5">
                    <div class="question-nav">
                        <div class="nav-title">ข้อ</div>
                        
                        <div class="question-grid" id="questionGrid">
                            <!-- จะถูกสร้างด้วย JavaScript -->
                        </div>
                    </div>

                    <div class="timer-box-single">
                        <div class="timer-item">
                            <span class="timer-label">เวลาทำข้อสอบ :</span>
                            <span class="timer-value" id="timerTotal">60:00</span>
                        </div>
                        <div class="timer-divider"></div>
                        <div class="timer-item">
                            <span class="timer-label">เวลาที่เหลือ :</span>
                            <span class="timer-value-red" id="timeRemaining">20:30</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer-main">
    <div class="container mb-5">
      <div class="row">

        <div class="col-md-4 mb-4">
          <img src="pic/logo2.png" style="height:50px;" class="mb-2" alt="logo footer">
          <p class="mb-1">123 ถ. ลาดพร้าว 64 แยก 4 แขวงวังทองหลาง เขตวังทองหลาง</p>
          <p class="mb-1">กรุงเทพมหานคร 10310</p>
          <p class="mb-0">โทรศัพท์ : 0X XXX XXXX</p>
        </div>

        <div class="col-md-4 mb-4">
          <div class="row">
            <div class="col-6 footer-links">
              <h6 class="fw-bold">เมนูหลัก</h6>
              <a href="index.html">หน้าหลัก</a>
              <a href="allcourse.html">รายวิชา</a>
              <a href="allnews.html">ข่าวประชาสัมพันธ์</a>
              <a href="faq.html">คำถามที่พบบ่อย</a>
            </div>

            <div class="col-6 footer-links">
              <h6 class="fw-bold">การใช้งาน</h6>
              <a href="usebility.html">วิธีการใช้งาน</a>
              <a href="contect.html">ติดต่อเรา</a>
              <a href="#">นโยบายเว็บไซต์</a>
              <a href="#">นโยบายความเป็นส่วนตัว</a>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4">
          <h6 class="fw-bold">ติดตามเรา</h6>
          <div class="footer-social mt-2">
            <a href="#" class="facebook"><img src="https://img.icons8.com/fluency/96/facebook-new.png "
                class="facebook-icon"></a>
            <a href="#" class="x"><img src="https://img.icons8.com/ios-glyphs/30/twitterx--v1.png" class="x-icon"></a>
            <a href="#" class="youtube"><img src="pic/icons8-youtube-30.png" class="youtube-icon"></i></a>
          </div>
        </div>

      </div>
    </div>

    <div class="footer-bottom text-center">
      © 24 E-Learning
    </div>
  </footer>
  

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ตัวแปรสำคัญ
        let currentQ = 1;
        const totalQuestions = 15;
        let answers = {}; // เก็บคำตอบ {1: 'true', 2: 'false', ...}
        let totalSeconds = 30 * 60; // 30 นาที
        let timerInterval;

        // สร้างปุ่มข้อ 1-15
        function createQuestionGrid() {
            const grid = document.getElementById('questionGrid');
            for (let i = 1; i <= totalQuestions; i++) {
                const btn = document.createElement('div');
                btn.className = 'question-btn';
                btn.textContent = `ข้อ ${i}`;
                btn.id = `q-btn-${i}`;
                btn.onclick = () => goToQuestion(i);
                grid.appendChild(btn);
            }
            updateQuestionButtons();
        }

        // ไปข้อที่กำหนด
        function goToQuestion(num) {
            saveCurrentAnswer();
            currentQ = num;
            loadQuestion();
            updateQuestionButtons();
            updateNavigationButtons();
        }

        // โหลดคำถาม
        function loadQuestion() {
            document.getElementById('currentQuestion').textContent = currentQ;
            document.getElementById('questionText').textContent = 
                'Lorem ipsum dolor sit amet, consectetur adipiscing elit, seddiamonummy eirmod tempor invidiunt ut labore et dolore magna aliquam erat, sed diam voluptus ?';
            
            // โหลดคำตอบที่เคยเลือก
            const savedAnswer = answers[currentQ];
            document.querySelectorAll('input[name="answer"]').forEach(input => {
                input.checked = (input.value === savedAnswer);
            });
        }

        // บันทึกคำตอบปัจจุบัน
        function saveCurrentAnswer() {
            const selected = document.querySelector('input[name="answer"]:checked');
            if (selected) {
                answers[currentQ] = selected.value;
            }
        }

        // อัพเดทสีปุ่มข้อ
        function updateQuestionButtons() {
            for (let i = 1; i <= totalQuestions; i++) {
                const btn = document.getElementById(`q-btn-${i}`);
                btn.classList.remove('answered', 'current');
                
                if (i === currentQ) {
                    btn.classList.add('current');
                }
                if (answers[i]) {
                    btn.classList.add('answered');
                }
            }
        }

        // อัพเดทปุ่มนำทาง
        function updateNavigationButtons() {
            const btnPrev = document.getElementById('btnPrev');
            const btnNext = document.getElementById('btnNext');
            const btnSubmit = document.getElementById('btnSubmit');
            const navButtons = document.querySelector('.nav-buttons');

            // แสดง/ซ่อนปุ่มย้อนกลับ
            if (currentQ === 1) {
                btnPrev.style.display = 'none';
                navButtons.classList.remove('has-prev');
            } else {
                btnPrev.style.display = 'inline-block';
                navButtons.classList.add('has-prev');
            }
            
            // แสดงปุ่มถัดไปหรือส่งข้อสอบ
            if (currentQ === totalQuestions) {
                btnNext.style.display = 'none';
                btnSubmit.style.display = 'inline-block';
            } else {
                btnNext.style.display = 'inline-block';
                btnSubmit.style.display = 'none';
            }
        }

        // ข้อถัดไป
        function nextQuestion() {
            if (currentQ < totalQuestions) {
                saveCurrentAnswer();
                currentQ++;
                loadQuestion();
                updateQuestionButtons();
                updateNavigationButtons();
            }
        }

        // ข้อก่อนหน้า
        function previousQuestion() {
            if (currentQ > 1) {
                saveCurrentAnswer();
                currentQ--;
                loadQuestion();
                updateQuestionButtons();
                updateNavigationButtons();
            }
        }

        // Timer
        function startTimer() {
            const totalMinutes = 30;
            document.getElementById('timerTotal').textContent = `${totalMinutes}:00`;
            
            timerInterval = setInterval(() => {
                totalSeconds--;
                
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                
                document.getElementById('timeRemaining').textContent = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                
                if (totalSeconds <= 0) {
                    clearInterval(timerInterval);
                    alert('หมดเวลาทำข้อสอบ!');
                    submitTest();
                }
            }, 1000);
        }

        // ส่งข้อสอบ
        function submitTest() {
            saveCurrentAnswer();
            
            const answeredCount = Object.keys(answers).length;
            if (answeredCount < totalQuestions) {
                if (!confirm(`คุณทำข้อสอบเพียง ${answeredCount}/${totalQuestions} ข้อ ต้องการส่งข้อสอบใช่หรือไม่?`)) {
                    return;
                }
            }

            clearInterval(timerInterval);
            
            // คำนวณคะแนน (คำตอบที่ถูกคือ "true" ทุกข้อ)
            let correctCount = 0;
            for (let i = 1; i <= totalQuestions; i++) {
                if (answers[i] === 'true') {
                    correctCount++;
                }
            }
            
            const score = (correctCount / totalQuestions * 100).toFixed(2);
            
            // เก็บข้อมูลไว้ใน sessionStorage
            sessionStorage.setItem('testScore', score);
            sessionStorage.setItem('correctAnswers', correctCount);
            sessionStorage.setItem('totalQuestions', totalQuestions);
            sessionStorage.setItem('answeredCount', answeredCount);
            sessionStorage.setItem('answers', JSON.stringify(answers));
            
            // ไปหน้าผลคะแนน
            window.location.href = 'pretest-result.html';
        }

        // เริ่มต้น
        window.addEventListener('load', () => {
            createQuestionGrid();
            loadQuestion();
            updateNavigationButtons();
            startTimer();
        });

        // เตือนเมื่อจะออกจากหน้า
        window.addEventListener('beforeunload', (e) => {
            e.preventDefault();
            e.returnValue = '';
        });
    </script>

    
</body>
</html>